"""
Скрипт для инициализации тестовых данных в базе
"""
from database import init_db, SessionLocal
from models import Film
from datetime import datetime

# Тестовые данные
test_films = [
    {
        "title": "Матрица",
        "director": "Лана и Лилли Вачовски",
        "year": 1999,
        "rating": 8.7,
        "genre": "Фантастика",
        "description": "Томас Андерсон ведет двойную жизнь программиста и хакера..."
    },
    {
        "title": "Криминальное чтиво",
        "director": "Квентин Тарантино",
        "year": 1994,
        "rating": 8.9,
        "genre": "Криминал",
        "description": "История о бандитах, наркоторговцах и боксерах..."
    },
    {
        "title": "Зеленая миля",
        "director": "Фрэнк Дарабонт",
        "year": 1999,
        "rating": 9.1,
        "genre": "Драма",
        "description": "История о невиновном человеке, приговоренном к смертной казни..."
    },
    {
        "title": "Побег из Шоушенка",
        "director": "Фрэнк Дарабонт",
        "year": 1994,
        "rating": 9.3,
        "genre": "Драма",
        "description": "История банкира, который был приговорен к пожизненному заключению..."
    },
    {
        "title": "Интерстеллар",
        "director": "Кристофер Нолан",
        "year": 2014,
        "rating": 8.6,
        "genre": "Фантастика",
        "description": "Группа исследователей отправляется в космическое путешествие..."
    },
    {
        "title": "Начало",
        "director": "Кристофер Нолан",
        "year": 2010,
        "rating": 8.8,
        "genre": "Фантастика",
        "description": "Профессиональный вор внедряется в сны людей..."
    },
    {
        "title": "Темный рыцарь",
        "director": "Кристофер Нолан",
        "year": 2008,
        "rating": 9.0,
        "genre": "Боевик",
        "description": "Бэтмен противостоит Джокеру..."
    },
    {
        "title": "Форрест Гамп",
        "director": "Роберт Земекис",
        "year": 1994,
        "rating": 8.8,
        "genre": "Драма",
        "description": "История жизни Форреста Гампа на фоне важных событий Америки..."
    },
    {
        "title": "Список Шиндлера",
        "director": "Стивен Спилберг",
        "year": 1993,
        "rating": 8.9,
        "genre": "Драма",
        "description": "История Оскара Шиндлера, спасшего более тысячи евреев..."
    },
    {
        "title": "Бойцовский клуб",
        "director": "Дэвид Финчер",
        "year": 1999,
        "rating": 8.8,
        "genre": "Драма",
        "description": "Офисный работник и мыловар создают подпольный бойцовский клуб..."
    },
    {
        "title": "Матрица: Перезагрузка",
        "director": "Лана и Лилли Вачовски",
        "year": 2003,
        "rating": 7.2,
        "genre": "Фантастика",
        "description": "Продолжение истории о Нео и его борьбе с машинами..."
    },
    {
        "title": "Крестный отец",
        "director": "Фрэнсис Форд Коппола",
        "year": 1972,
        "rating": 9.2,
        "genre": "Криминал",
        "description": "История семьи мафиозного дона..."
    },
    {
        "title": "Властелин колец: Возвращение короля",
        "director": "Питер Джексон",
        "year": 2003,
        "rating": 8.9,
        "genre": "Фэнтези",
        "description": "Финал эпической трилогии о кольце всевластья..."
    },
    {
        "title": "Криминальное чтиво 2",
        "director": "Квентин Тарантино",
        "year": 2019,
        "rating": 7.8,
        "genre": "Драма",
        "description": "История актера и его дублера в 1969 году..."
    },
    {
        "title": "Дюна",
        "director": "Дени Вильнёв",
        "year": 2021,
        "rating": 8.0,
        "genre": "Фантастика",
        "description": "История Пола Атрейдеса на планете Арракис..."
    }
]


def init_test_data():
    """Инициализация базы данных тестовыми данными"""
    # Создаем таблицы
    init_db()
    
    db = SessionLocal()
    try:
        # Проверяем, есть ли уже данные
        existing_count = db.query(Film).count()
        if existing_count > 0:
            print(f"В базе уже есть {existing_count} фильмов. Пропускаем инициализацию.")
            return
        
        # Добавляем тестовые данные
        for film_data in test_films:
            film = Film(**film_data)
            db.add(film)
        
        db.commit()
        print(f"Успешно добавлено {len(test_films)} фильмов в базу данных!")
    except Exception as e:
        db.rollback()
        print(f"Ошибка при добавлении данных: {e}")
    finally:
        db.close()


if __name__ == "__main__":
    print("Инициализация тестовых данных...")
    init_test_data()
    print("Готово!")

